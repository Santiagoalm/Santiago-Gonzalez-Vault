#### Se pide agregar los campos costo y moneda al reporte INFOMRACION_ITEMS_ACT. 

![[Pasted image 20250611100246.png]]

``` SQL
SELECT ESI.ITEM_NUMBER,
       EST.DESCRIPTION,
	   EST.LONG_DESCRIPTION,
	   TO_CHAR(ESI.CREATION_DATE,'DD-MM-YYYY HH24:MI') AS "CREATION_DATE",
	   SCS.TOTAL_COST,
	   SCS.CURRENCY_CODE
FROM EGP_SYSTEM_ITEMS_B ESI
LEFT JOIN EGP_SYSTEM_ITEMS_TL EST ON EST.INVENTORY_ITEM_ID = ESI.INVENTORY_ITEM_ID AND EST.ORGANIZATION_ID = ESI.ORGANIZATION_ID AND EST.LANGUAGE = USERENV('LANG')
LEFT JOIN INV_ORG_PARAMETERS ORG ON ORG.ORGANIZATION_ID = ESI.ORGANIZATION_ID
LEFT JOIN EGP_ITEM_CAT_ASSIGNMENTS ITEM_CAT ON ITEM_CAT.INVENTORY_ITEM_ID = ESI.INVENTORY_ITEM_ID AND ITEM_CAT.ORGANIZATION_ID = ESI.ORGANIZATION_ID AND ITEM_CAT.CATEGORY_SET_ID = '300000006415088'
LEFT JOIN CST_STD_COSTS SCS ON SCS.INVENTORY_ORG_ID = ESI.ORGANIZATION_ID AND SCS.INVENTORY_ITEM_ID = ESI.INVENTORY_ITEM_ID AND EFFECTIVE_END_DATE = '4712-12-31'
LEFT JOIN CST_SCENARIOS CS ON CS.SCENARIO_ID = SCS.SCENARIO_ID AND SCS.COST_ORG_ID = CS.COST_ORG_ID AND SCS.COST_BOOK_ID = CS.COST_BOOK_ID
LEFT JOIN HR_ORGANIZATION_UNITS_F_TL ORGCOS ON ORGCOS.ORGANIZATION_ID = CS.COST_ORG_ID AND ORGCOS.LANGUAGE = USERENV('LANG')
WHERE ESI.ITEM_NUMBER = NVL(:P_ITEM_NUMBER, ESI.ITEM_NUMBER)
AND ORG.ORGANIZATION_CODE = 'MASTER_ALMEX'
ORDER BY ESI.ITEM_NUMBER


--Query modificado


SELECT DISTINCT ESI.ITEM_NUMBER,
	   EST.DESCRIPTION,
	   EST.LONG_DESCRIPTION,
	   TO_CHAR(ESI.CREATION_DATE,'DD-MM-YYYY HH24:MI') AS "CREATION_DATE",
	   SCS.TOTAL_COST,
	   SCS.CURRENCY_CODE
FROM EGP_SYSTEM_ITEMS_B ESI
INNER JOIN EGP_SYSTEM_ITEMS_TL EST ON EST.INVENTORY_ITEM_ID = ESI.INVENTORY_ITEM_ID
INNER JOIN INV_ORG_PARAMETERS ORG ON ORG.ORGANIZATION_ID = ESI.ORGANIZATION_ID
INNER JOIN EGP_ITEM_CAT_ASSIGNMENTS ITEM_CAT ON ITEM_CAT.INVENTORY_ITEM_ID = ESI.INVENTORY_ITEM_ID
INNER JOIN CST_STD_COSTS SCS ON SCS.INVENTORY_ITEM_ID = ESI.INVENTORY_ITEM_ID
WHERE ORG.ORGANIZATION_CODE = 'MASTER_ALMEX'
ORDER BY ESI.ITEM_NUMBER

```


## Tablas utilizadas: 

- EGP_SYSTEM_ITEMS_TL -> ESI

- INV_ORG_PARAMETERS ->ES

- EGP_ITEM_CAT_ASSIGNMENTS ->ITEM_CAT

- CST_STD_COSTS -> CSC

- CST_SCENARIOS -> CS

## Procedimiento:

Vía mensaje se preguntan detalles acerca del reporte y se especifican estos campos: 
- Código.
- Descripción.
- Descripción larga. 
- Precio.
- Moneda.
- Fecha de compra. 

Primero se extrae la tabla principal ya que es un reporte en base a uno existente, la tabla pivote es: 
EGP_SYSTEM_ITEMS_B -> ESI y observamos que el reporte ya nos da los datos que necesitamos a excepción de los campos precio y moneda. 

Cómo la relación de todas las tablas ya existe, solo vamos a la tabla de costo y analizamos cuál llave foránea queda mejor en este caso. 
Cómo INVENTORY_ITEM_ID es un a llave en común de ambas tablas, utilizamos este campo para hacer la relación con el Query anterior:

INNER JOIN CST_STD_COSTS SCS ON SCS.INVENTORY_ITEM_ID = ESI.INVENTORY_ITEM_ID

Una vez estando conectados declaramos los campos que queremos ver de la tabla (precio y moneda).

SCS.TOTAL_COST,
SCS.CURRENCY_CODE



